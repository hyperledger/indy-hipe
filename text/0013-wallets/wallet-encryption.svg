<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="399px" preserveAspectRatio="none" style="width:1319px;height:399px;" version="1.1" viewBox="0 0 1319 399" width="1319px" zoomAndPan="magnify"><defs><filter height="300%" id="f47vyu5py32du" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class Tag--><rect fill="#FEFECE" filter="url(#f47vyu5py32du)" height="75.6719" id="Tag" style="stroke: #A80036; stroke-width: 1.5;" width="53" x="498" y="176"/><ellipse cx="513" cy="192" fill="#B4A7E5" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M513.9531,188.6406 L513.9531,195.2969 L515.6719,195.2969 Q516.2813,195.2969 516.5469,195.5313 Q516.8125,195.7656 516.8125,196.1563 Q516.8125,196.5313 516.5469,196.7656 Q516.2813,197 515.6719,197 L510.5313,197 Q509.9219,197 509.6563,196.7656 Q509.3906,196.5313 509.3906,196.1406 Q509.3906,195.7656 509.6563,195.5313 Q509.9219,195.2969 510.5313,195.2969 L512.25,195.2969 L512.25,188.6406 L510.5313,188.6406 Q509.9219,188.6406 509.6563,188.4063 Q509.3906,188.1719 509.3906,187.7813 Q509.3906,187.4063 509.6563,187.1719 Q509.9219,186.9375 510.5313,186.9375 L515.6719,186.9375 Q516.2813,186.9375 516.5469,187.1719 Q516.8125,187.4063 516.8125,187.7813 Q516.8125,188.1719 516.5469,188.4063 Q516.2813,188.6406 515.6719,188.6406 L513.9531,188.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="21" x="527" y="196.9102">Tag</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="499" x2="550" y1="208" y2="208"/><ellipse cx="509" cy="220.418" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="26" x="518" y="223.4189">name</text><ellipse cx="509" cy="234.2539" fill="none" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="26" x="518" y="237.2549">value</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="499" x2="550" y1="243.6719" y2="243.6719"/><!--class EncryptedTag--><rect fill="#FEFECE" filter="url(#f47vyu5py32du)" height="75.6719" id="EncryptedTag" style="stroke: #A80036; stroke-width: 1.5;" width="501" x="6" y="313"/><ellipse cx="214.75" cy="329" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M217.5156,324.875 Q217.6719,324.6563 217.8594,324.5469 Q218.0469,324.4375 218.2656,324.4375 Q218.6406,324.4375 218.875,324.6953 Q219.1094,324.9531 219.1094,325.5625 L219.1094,327.0156 Q219.1094,327.625 218.875,327.8906 Q218.6406,328.1563 218.2656,328.1563 Q217.9219,328.1563 217.7188,327.9531 Q217.5156,327.7656 217.4063,327.25 Q217.3594,326.8906 217.1719,326.7031 Q216.8438,326.3281 216.2344,326.1094 Q215.625,325.8906 215,325.8906 Q214.2344,325.8906 213.6016,326.2188 Q212.9688,326.5469 212.4766,327.2969 Q211.9844,328.0469 211.9844,329.0781 L211.9844,330.1719 Q211.9844,331.4063 212.875,332.2266 Q213.7656,333.0469 215.3594,333.0469 Q216.2969,333.0469 216.9531,332.7969 Q217.3438,332.6406 217.7656,332.2031 Q218.0313,331.9375 218.1797,331.8594 Q218.3281,331.7813 218.5313,331.7813 Q218.8594,331.7813 219.1172,332.0391 Q219.375,332.2969 219.375,332.6406 Q219.375,332.9844 219.0313,333.3906 Q218.5313,333.9688 217.7344,334.2969 Q216.6563,334.75 215.3594,334.75 Q213.8438,334.75 212.6406,334.125 Q211.6563,333.625 210.9688,332.5547 Q210.2813,331.4844 210.2813,330.2031 L210.2813,329.0469 Q210.2813,327.7188 210.8984,326.5703 Q211.5156,325.4219 212.6094,324.8047 Q213.7031,324.1875 214.9375,324.1875 Q215.6719,324.1875 216.3203,324.3516 Q216.9688,324.5156 217.5156,324.875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="235.25" y="333.9102">EncryptedTag</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="506" y1="345" y2="345"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="506" y1="353" y2="353"/><ellipse cx="17" cy="365.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="475" x="26" y="368.4189">name: XChaCha20-Poly1305(data=tag_name, key=k5, iv=HMAC-SHA256(data=tag_name, key=k7))</text><ellipse cx="17" cy="379.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="475" x="26" y="382.2549">value: XChaCha20-Poly1305(data=tag_value, key=k6, iv=HMAC-SHA256(data=tag_value, key=k7))</text><!--class UnencryptedTag--><rect fill="#FEFECE" filter="url(#f47vyu5py32du)" height="75.6719" id="UnencryptedTag" style="stroke: #A80036; stroke-width: 1.5;" width="501" x="542" y="313"/><ellipse cx="743.25" cy="329" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M746.0156,324.875 Q746.1719,324.6563 746.3594,324.5469 Q746.5469,324.4375 746.7656,324.4375 Q747.1406,324.4375 747.375,324.6953 Q747.6094,324.9531 747.6094,325.5625 L747.6094,327.0156 Q747.6094,327.625 747.375,327.8906 Q747.1406,328.1563 746.7656,328.1563 Q746.4219,328.1563 746.2188,327.9531 Q746.0156,327.7656 745.9063,327.25 Q745.8594,326.8906 745.6719,326.7031 Q745.3438,326.3281 744.7344,326.1094 Q744.125,325.8906 743.5,325.8906 Q742.7344,325.8906 742.1016,326.2188 Q741.4688,326.5469 740.9766,327.2969 Q740.4844,328.0469 740.4844,329.0781 L740.4844,330.1719 Q740.4844,331.4063 741.375,332.2266 Q742.2656,333.0469 743.8594,333.0469 Q744.7969,333.0469 745.4531,332.7969 Q745.8438,332.6406 746.2656,332.2031 Q746.5313,331.9375 746.6797,331.8594 Q746.8281,331.7813 747.0313,331.7813 Q747.3594,331.7813 747.6172,332.0391 Q747.875,332.2969 747.875,332.6406 Q747.875,332.9844 747.5313,333.3906 Q747.0313,333.9688 746.2344,334.2969 Q745.1563,334.75 743.8594,334.75 Q742.3438,334.75 741.1406,334.125 Q740.1563,333.625 739.4688,332.5547 Q738.7813,331.4844 738.7813,330.2031 L738.7813,329.0469 Q738.7813,327.7188 739.3984,326.5703 Q740.0156,325.4219 741.1094,324.8047 Q742.2031,324.1875 743.4375,324.1875 Q744.1719,324.1875 744.8203,324.3516 Q745.4688,324.5156 746.0156,324.875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="90" x="763.75" y="333.9102">UnencryptedTag</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="543" x2="1042" y1="345" y2="345"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="543" x2="1042" y1="353" y2="353"/><ellipse cx="553" cy="365.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="475" x="562" y="368.4189">name: XChaCha20-Poly1305(data=tag_name, key=k5, iv=HMAC-SHA256(data=tag_name, key=k7))</text><ellipse cx="553" cy="379.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="136" x="562" y="382.2549">value: plain(data=tag_value)</text><!--class Record--><rect fill="#FEFECE" filter="url(#f47vyu5py32du)" height="89.5078" id="Record" style="stroke: #A80036; stroke-width: 1.5;" width="635" x="207" y="8"/><ellipse cx="500.25" cy="24" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M503.0156,19.875 Q503.1719,19.6563 503.3594,19.5469 Q503.5469,19.4375 503.7656,19.4375 Q504.1406,19.4375 504.375,19.6953 Q504.6094,19.9531 504.6094,20.5625 L504.6094,22.0156 Q504.6094,22.625 504.375,22.8906 Q504.1406,23.1563 503.7656,23.1563 Q503.4219,23.1563 503.2188,22.9531 Q503.0156,22.7656 502.9063,22.25 Q502.8594,21.8906 502.6719,21.7031 Q502.3438,21.3281 501.7344,21.1094 Q501.125,20.8906 500.5,20.8906 Q499.7344,20.8906 499.1016,21.2188 Q498.4688,21.5469 497.9766,22.2969 Q497.4844,23.0469 497.4844,24.0781 L497.4844,25.1719 Q497.4844,26.4063 498.375,27.2266 Q499.2656,28.0469 500.8594,28.0469 Q501.7969,28.0469 502.4531,27.7969 Q502.8438,27.6406 503.2656,27.2031 Q503.5313,26.9375 503.6797,26.8594 Q503.8281,26.7813 504.0313,26.7813 Q504.3594,26.7813 504.6172,27.0391 Q504.875,27.2969 504.875,27.6406 Q504.875,27.9844 504.5313,28.3906 Q504.0313,28.9688 503.2344,29.2969 Q502.1563,29.75 500.8594,29.75 Q499.3438,29.75 498.1406,29.125 Q497.1563,28.625 496.4688,27.5547 Q495.7813,26.4844 495.7813,25.2031 L495.7813,24.0469 Q495.7813,22.7188 496.3984,21.5703 Q497.0156,20.4219 498.1094,19.8047 Q499.2031,19.1875 500.4375,19.1875 Q501.1719,19.1875 501.8203,19.3516 Q502.4688,19.5156 503.0156,19.875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="40" x="520.75" y="28.9102">Record</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="208" x2="841" y1="40" y2="40"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="208" x2="841" y1="48" y2="48"/><ellipse cx="218" cy="60.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="418" x="227" y="63.4189">type: XChaCha20-Poly1305(data=type, key=k1, iv=HMAC-SHA256(data=type, key=k4))</text><ellipse cx="218" cy="74.2539" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="433" x="227" y="77.2549">name: XChaCha20-Poly1305(data=name, key=k2, iv=HMAC-SHA256(data=name, key=k4))</text><ellipse cx="218" cy="88.0898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="609" x="227" y="91.0908">value: XChaCha20-Poly1305(data=value_key, key=k3, iv=rand())||XChaCha20-Poly1305(data=value, key=value_key, iv=rand())</text><!--class Metadata--><rect fill="#FEFECE" filter="url(#f47vyu5py32du)" height="61.8359" id="Metadata" style="stroke: #A80036; stroke-width: 1.5;" width="431" x="877" y="22"/><ellipse cx="1063.25" cy="38" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1066.0156,33.875 Q1066.1719,33.6563 1066.3594,33.5469 Q1066.5469,33.4375 1066.7656,33.4375 Q1067.1406,33.4375 1067.375,33.6953 Q1067.6094,33.9531 1067.6094,34.5625 L1067.6094,36.0156 Q1067.6094,36.625 1067.375,36.8906 Q1067.1406,37.1563 1066.7656,37.1563 Q1066.4219,37.1563 1066.2188,36.9531 Q1066.0156,36.7656 1065.9063,36.25 Q1065.8594,35.8906 1065.6719,35.7031 Q1065.3438,35.3281 1064.7344,35.1094 Q1064.125,34.8906 1063.5,34.8906 Q1062.7344,34.8906 1062.1016,35.2188 Q1061.4688,35.5469 1060.9766,36.2969 Q1060.4844,37.0469 1060.4844,38.0781 L1060.4844,39.1719 Q1060.4844,40.4063 1061.375,41.2266 Q1062.2656,42.0469 1063.8594,42.0469 Q1064.7969,42.0469 1065.4531,41.7969 Q1065.8438,41.6406 1066.2656,41.2031 Q1066.5313,40.9375 1066.6797,40.8594 Q1066.8281,40.7813 1067.0313,40.7813 Q1067.3594,40.7813 1067.6172,41.0391 Q1067.875,41.2969 1067.875,41.6406 Q1067.875,41.9844 1067.5313,42.3906 Q1067.0313,42.9688 1066.2344,43.2969 Q1065.1563,43.75 1063.8594,43.75 Q1062.3438,43.75 1061.1406,43.125 Q1060.1563,42.625 1059.4688,41.5547 Q1058.7813,40.4844 1058.7813,39.2031 L1058.7813,38.0469 Q1058.7813,36.7188 1059.3984,35.5703 Q1060.0156,34.4219 1061.1094,33.8047 Q1062.2031,33.1875 1063.4375,33.1875 Q1064.1719,33.1875 1064.8203,33.3516 Q1065.4688,33.5156 1066.0156,33.875 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="50" x="1083.75" y="42.9102">Metadata</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="878" x2="1307" y1="54" y2="54"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="878" x2="1307" y1="62" y2="62"/><ellipse cx="888" cy="74.418" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="405" x="897" y="77.4189">keys: XChaCha20-Poly1305(data=k1||k2||k3||k4||k5||k6||k7, key=master_key, iv=rand())</text><!--link Tag to EncryptedTag--><path d="M479.86,237.486 C439.122,258.007 378.136,288.728 330.178,312.886 " fill="none" id="Tag-EncryptedTag" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="476.812,231.184,497.823,228.438,483.111,243.687,476.812,231.184" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Tag to UnencryptedTag--><path d="M569.14,237.486 C609.878,258.007 670.864,288.728 718.822,312.886 " fill="none" id="Tag-UnencryptedTag" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="565.889,243.687,551.177,228.438,572.188,231.184,565.889,243.687" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Record to Tag--><path d="M524.5,98.29 C524.5,118.341 524.5,142.135 524.5,162.841 " fill="none" id="Record-Tag" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="524.5,175.932,528.5,169.932,524.5,163.932,520.5,169.932,524.5,175.932" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="525.5" y="142.4951">tags</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="517.0297" y="119.0027">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="5" x="519.0547" y="165.2818">*</text><!--
@startuml wallet-encryption

interface Tag {
    +name
    +value
}

class EncryptedTag {
    +name: XChaCha20-Poly1305(data=tag_name, key=k5, iv=HMAC-SHA256(data=tag_name, key=k7))
    +value: XChaCha20-Poly1305(data=tag_value, key=k6, iv=HMAC-SHA256(data=tag_value, key=k7))
}
Tag <|- - EncryptedTag

class UnencryptedTag {
     +name: XChaCha20-Poly1305(data=tag_name, key=k5, iv=HMAC-SHA256(data=tag_name, key=k7))
     +value: plain(data=tag_value)
 }
Tag <|- - UnencryptedTag


class Record {
    +type: XChaCha20-Poly1305(data=type, key=k1, iv=HMAC-SHA256(data=type, key=k4))
    +name: XChaCha20-Poly1305(data=name, key=k2, iv=HMAC-SHA256(data=name, key=k4))
    +value: XChaCha20-Poly1305(data=value_key, key=k3, iv=rand())||XChaCha20-Poly1305(data=value, key=value_key, iv=rand())    
}
Record "1" - -* "*" Tag : tags

class Metadata {    
    +keys: XChaCha20-Poly1305(data=k1||k2||k3||k4||k5||k6||k7, key=master_key, iv=rand())
}

@enduml

PlantUML version 1.2018.03(Thu Apr 05 19:59:15 MSK 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_151-b12
Operating System: Windows 10
OS Version: 10.0
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>